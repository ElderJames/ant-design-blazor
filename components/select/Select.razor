@namespace AntDesign
@inherits AntDomComponentBase

<CascadingValue Value=this>
    <div class="@ClassMapper.Class" style="@Style" id="@Id" title="@Title" @onclick="OnSelectOpenClick" @ref="Ref">
        @switch (SelectMode)
        {
            case SelectMode.Default:
                {
                    var selectedOption = SelectedOptions.FirstOrDefault();
                    <div class="@ClassPrefix-selector">
                        <span class="@ClassPrefix-selection-search">
                            <input @ref="_inputRef"
                                   @oninput="OnInput"
                                   id="@Id"
                                   value="@_searchValue"
                                   role="combobox"
                                   readonly="@(!_isSelectOpened)"
                                   class="@ClassPrefix-selection-search-input"
                                   style="@(_isSelectOpened?"":"opacity:0")"
                                   autocomplete="off"
                                   aria-owns="@(Id)_list"
                                   aria-expanded="@_isSelectOpened"
                                   aria-haspopup="listbox"
                                   aria-autocomplete="list"
                                   aria-controls="@(Id)_list" />
                        </span>
                        @if (ShowPlaceholder)
                        {
                            <span class="ant-select-selection-placeholder">@Placeholder</span>
                        }
                        else if (string.IsNullOrEmpty(_searchValue) && selectedOption != null)
                        {
                            var showValue = GetShowValue(selectedOption);
                            @if (showValue.IsT0)
                            {
                                <span class="ant-select-selection-item">@showValue.AsT0 </span>
                            }
                            else
                            {
                                <span class="ant-select-selection-item">@showValue.AsT1 </span>
                            }
                        }
                    </div>
                    break;
                }
            default:
                {
                    <div class="@ClassPrefix-selector">
                        @foreach (var option in SelectedOptions)
                        {
                            if (TagRender!=null){
                                <span>@TagRender(GetProperties(option))</span>
                            }
                            else
                            {
                                var showValue = GetShowValue(option);
                                <span class="@ClassPrefix-selection-item">
                                    @if (showValue.IsT0)
                                    {
                                        <span class="@ClassPrefix-selection-item-content">@showValue.AsT0 </span>
                                    }
                                    else
                                    {
                                        <span class="@ClassPrefix-selection-item-content">@showValue.AsT1</span>
                                    }
                                    <span unselectable="on"
                                          aria-hidden="true"
                                          style="user-select: none;"
                                          class="@ClassPrefix-selection-item-remove"
                                          @onclick:stopPropagation
                                          @onclick="()=>OnRemoveSelected(option)">
                                        <span role="img" aria-label="close" class="anticon anticon-close">
                                            <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="close" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                                                <path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"></path>
                                            </svg>
                                        </span>
                                    </span>
                                </span>
                            }
                        }
                        <span class="@ClassPrefix-selection-search" style="width:@_inputWidth">
                            <input @ref="_inputRef"
                                   @oninput="OnInput"
                                   id="@Id"
                                   value="@_searchValue"
                                   role="combobox"
                                   readonly="@(!_isSelectOpened)"
                                   class="@ClassPrefix-selection-search-input"
                                   style="@(_isSelectOpened?"":"opacity:0")"
                                   autocomplete="off"
                                   aria-owns="@(Id)_list"
                                   aria-expanded="@_isSelectOpened"
                                   aria-haspopup="listbox"
                                   aria-autocomplete="list"
                                   aria-controls="@(Id)_list" />
                            <span class="@ClassPrefix-selection-search-mirror" aria-hidden="true">&nbsp;</span>
                        </span>
                        @if (ShowPlaceholder)
                        {
                            <span class="ant-select-selection-placeholder">@Placeholder</span>
                        }
                    </div>
                    break;
                }
        }

        @if (ShowArrow && SelectMode == SelectMode.Default)
        {
            if (SuffixIcon != null)
            {
                <span class="ant-select-arrow" unselectable="on" aria-hidden="true" style="user-select: none;">
                    @SuffixIcon
                </span>
            }
            else if (Loading)
            {
                <span class="ant-select-arrow ant-select-arrow-loading" unselectable="on" aria-hidden="true" style="user-select: none;">
                    <span role="img" aria-label="loading" class="anticon anticon-loading">
                        <svg viewBox="0 0 1024 1024" focusable="false" class="anticon-spin" data-icon="loading" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                            <path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path>
                        </svg>
                    </span>
                </span>
            }
            else
            {
                <span class="ant-select-arrow" unselectable="on" aria-hidden="true" style="user-select: none;">
                    @if (ShowSearch && _isSelectOpened)
                    {
                        <span role="img" aria-label="search" class="anticon anticon-search">
                            <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="search" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                                <path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z">
                                </path>
                            </svg>
                        </span>
                    }
                    else
                    {
                        <span role="img" aria-label="down" class="anticon anticon-down">
                            <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                                <path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z">
                                </path>
                            </svg>
                        </span>
                    }
                </span>
                @if (AllowClear && HasValue)
                {
                    <span class="ant-select-clear" unselectable="on" aria-hidden="true" style="user-select: none;" @onclick="OnClearClick">
                        <span role="img" aria-label="close-circle" class="anticon anticon-close-circle">
                            <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                                <path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"></path>
                            </svg>
                        </span>
                    </span>
                }
            }
        }
    </div>
    <div style="position: absolute; top: 0px; left: 0px; width: 100%;" @ref="_dropdownRef">
        <div>
            <div class="@(ClassPrefix)-dropdown @_dropdownClassMapper.Class" style="@_dropdownStyle">
                <div>
                    @if (IsEmptyOnSearch())
                    {
                        <div role="listbox" id="@(Id)_list" class="@ClassPrefix-item-empty">
                            <div class="ant-empty ant-empty-normal ant-empty-small">
                                <div class="ant-empty-image">
                                    <svg class="ant-empty-img-simple" width="64" height="41" viewBox="0 0 64 41"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <g transform="translate(0 1)" fill="none" fill-rule="evenodd">
                                            <ellipse class="ant-empty-img-simple-ellipse" cx="32" cy="33" rx="32" ry="7"></ellipse>
                                            <g class="ant-empty-img-simple-g" fill-rule="nonzero">
                                                <path d="M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z">
                                                </path>
                                                <path d="M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z"
                                                      class="ant-empty-img-simple-path"></path>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                                <p class="ant-empty-description">暂无数据</p>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div role="listbox" id="@(Id)_list" style="height: 0px; width: 0px; overflow: hidden;">
                            @for (var i = 0; SelectOptions.Count > i; ++i)
                            {
                                var selectOption = SelectOptions[i];
                                <div role="option" id="@(Id)_list_@(i)"
                                     aria-label="@selectOption.Value"
                                     aria-selected="@GetAriaSelected(selectOption)">@selectOption.Value</div>
                                }
                        </div>
                        <div class="" style="max-height:256px; overflow-y:auto; overflow-anchor:none;">
                            <div>
                                <div class="" style="display: flex; flex-direction: column;">
                                    @if (IsCreatedTagOption())
                                    {
                                        <SelectOption Value="@_searchValue" IsTagOption="true">@_searchValue </SelectOption>
                                    }

                                    @ChildContent

                                    @if (Options != null && Options.Any())
                                    {
                                        foreach (var option in Options)
                                        {
                                            <SelectOption Value="@option.Key">@option.Label</SelectOption>
                                        }
                                    }

                                    @foreach (var tagOption in _tagOptions)
                                    {
                                        <SelectOption Value="@tagOption" IsTagOption="true">@tagOption </SelectOption>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</CascadingValue>
